"use strict";function Game(n){var t=this,r,i;t.included=includedObservable;t.updatePhase=updatePhaseObservable;t.steamPlaytime=n.Playtime;r=n.SteamAppData;t.steamAppId=r.SteamAppId;t.steamName=r.SteamName;t.appType=r.AppType;t.platforms=r.Platforms;t.genres=ko.utils.arrayMap(r.Genres,genreSeparatorReplacer);t.releaseYear=r.ReleaseYear;t.metacriticScore=r.MetacriticScore;i=r.HltbInfo;t.known=i.Id!==-1;t.hltbId=t.known?i.Id:"";t.suggestedHltbId=zeroObservable;t.hltbName=t.known?i.Name:"";t.hltbMainTtb=i.MainTtb;t.hltbMainTtbImputed=i.MainTtbImputed;t.hltbExtrasTtb=i.ExtrasTtb;t.hltbExtrasTtbImputed=i.ExtrasTtbImputed;t.hltbCompletionistTtb=i.CompletionistTtb;t.hltbCompletionistTtbImputed=i.CompletionistTtbImputed}function AppViewModel(){var n=this,l,tt;n.steamVanityUrlName=ko.observable("");l={recordWord:"game",sortDir:"asc",perPage:10,unsortedClass:"glyphicon glyphicon-sort",ascSortClass:"glyphicon glyphicon-sort-by-attributes",descSortClass:"glyphicon glyphicon-sort-by-attributes-alt"};n.introPage=ko.observable(!0);n.gameTable=new DataTable([],l);n.pageSizeOptions=[10,25,50];n.sliceTotal=ko.observable();n.sliceCompletionLevel=ko.observable();n.partialCache=ko.observable(!1);n.imputedTtbs=ko.observable(!1);n.missingHltbIds=ko.observable(!1);n.processing=ko.observable(!1);n.error=ko.observable(!1);n.bonusLinkVisible=ko.observable(!0);n.alertHidden=ko.observable(!1);n.missingAlertHidden=ko.observable(!1);n.errorAlertHidden=ko.observable(!1);n.gameToUpdate=ko.observable({steamAppId:0,steamName:"",hltbId:"",suggestedHltbId:ko.observable("")});n.toggleAllChecked=ko.observable(!0);n.toggleAllCore=function(t){for(var r=n.gameTable.rows(),i=0;i<r.length;i++)r[i].included(t)};n.toggleAll=function(){return n.toggleAllCore(!n.toggleAllChecked()),!0};var it=function(n,t,i,r,u,f){switch(n){case PlaytimeType.Current:return t?i.steamPlaytime:r;case PlaytimeType.Main:return t?i.hltbMainTtb:r;case PlaytimeType.Extras:return t?i.hltbExtrasTtb:u;case PlaytimeType.Completionist:return t?i.hltbCompletionistTtb:f;default:return console.error("Invalid playtime slice type: "+n),0}},t=function(n,t,i){n.hasOwnProperty(t)?n[t]+=i:n[t]=i},rt=["Unknown","Windows","Mac","Windows, Mac","Linux","Windows, Linux","Mac, Linux","Windows, Mac, Linux"];n.total=ko.pureComputed(function(){var u=n.gameTable.filteredRows(),st=n.sliceCompletionLevel(),ht=n.sliceTotal(),s,f,h,o,i;if(n.initialTotal!==undefined){for(includedObservable(),s=Math.min(u.length,n.gameTable.perPage()),f=0;f<s;f++)u[f].included();return n.toggleAllChecked(!0),h=n.initialTotal,n.initialTotal=undefined,h}var e=0,c=0,l=0,a=0,v=0,y=0,p=0,w=0,b={},k={},d={},g={},nt={},tt=ko.utils.arrayFilter(u,function(n){return n.included()});for(o=0;o<tt.length;++o){i=tt[o];e++;c+=i.steamPlaytime;l+=i.hltbMainTtb;a+=i.hltbExtrasTtb;v+=i.hltbCompletionistTtb;var ut=Math.max(0,i.hltbMainTtb-i.steamPlaytime),ft=Math.max(0,i.hltbExtrasTtb-i.steamPlaytime),et=Math.max(0,i.hltbCompletionistTtb-i.steamPlaytime);y+=ut;p+=ft;w+=et;var ot=ko.utils.arrayFilter(i.genres,function(n){return n!=="Indie"&&n!=="Casual"}),ct=(ot.length===0?i.genres:ot).join("/"),r=it(st,ht,i,ut,ft,et);t(b,ct,r);t(k,i.metacriticScore,r);t(d,i.appType,r);t(nt,rt[i.platforms],r);t(g,i.releaseYear,r)}return e===u.length?n.toggleAllChecked(!0):e===0&&n.toggleAllChecked(!1),{count:e,playtime:c,mainTtb:l,extrasTtb:a,completionistTtb:v,mainRemaining:y,extrasRemaining:p,completionistRemaining:w,playtimesByGenre:b,playtimesByMetacritic:k,playtimesByAppType:d,playtimesByPlatform:nt,playtimesByReleaseYear:g}}).extend({rateLimit:0});n.pagedGames=ko.pureComputed(function(){for(var t,i=n.gameTable.pagedRows(),u=!1,r=0;r<i.length;r++)t=i[r],t.included===includedObservable&&(t.included=ko.observable(includedObservable.peek()),t.updatePhase=ko.observable(updatePhaseObservable()),t.suggestedHltbId=ko.observable(t.hltbId),u=!0);return u&&includedObservable.valueHasMutated(),i});n.vanityUrlSubmitted=function(){window.location.hash==="#/"+n.steamVanityUrlName()&&n.loadGames()};var ut=function(t){n.playtimeChart.dataProvider[0].hours=getHours(t.playtime);n.playtimeChart.dataProvider[1].hours=getHours(t.mainTtb);n.playtimeChart.dataProvider[2].hours=getHours(t.extrasTtb);n.playtimeChart.dataProvider[3].hours=getHours(t.completionistTtb);n.playtimeChart.validateData();n.remainingChart.dataProvider[0].hours=getHours(t.mainRemaining);n.remainingChart.dataProvider[1].hours=getHours(t.extrasRemaining);n.remainingChart.dataProvider[2].hours=getHours(t.completionistRemaining);n.remainingChart.validateData()},a=function(){switch(n.sliceCompletionLevel()){case PlaytimeType.Current:return getHours(n.sliceTotal()?n.total().playtime:n.total().mainRemaining);case PlaytimeType.Main:return getHours(n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining);case PlaytimeType.Extras:return getHours(n.sliceTotal()?n.total().extrasTtb:n.total().extrasRemaining);case PlaytimeType.Completionist:return getHours(n.sliceTotal()?n.total().completionistTtb:n.total().completionistRemaining);default:return console.error("Invalid playtime slice type: "+n.sliceCompletionLevel()),0}},r="Unknown",u=function(n,t){var s=getOrderedOwnProperties(t),h=a(),i,o,f,u,e;for(n.dataProvider=[],i=[],o=0,f=0;f<s.length;f++){if(u=s[f],e=getHours(t[u]),u===r||e/h<.01){i.push(u);o+=e;continue}n.dataProvider.push({title:u,hours:e})}i.length>=1&&n.dataProvider.push({title:i.length===1&&i[0]!==r?i[0]:"Other",hours:o,color:unknownColor});n.validateData()},ft=function(n){return function(t){return n<=t.max&&n>=t.min}},f=function(n,t){return n===t?n:n+"-"+t},v=function(n,t,i){for(var s,o,r,e=0;e<t.length;e++)t[e].observedMin=Number.POSITIVE_INFINITY,t[e].observedMax=Number.NEGATIVE_INFINITY;for(s=getOrderedOwnProperties(n),o=0;o<s.length;o++){var h=s[o],l=n[h],c=Number(h),u=ko.utils.arrayFirst(t,ft(c));u.hours+=getHours(l);u.observedMin=Math.min(u.observedMin,c);u.observedMax=Math.max(u.observedMax,c);typeof i!="undefined"&&i(u,h,l)}for(r=0;r<t.length;r++)t[r].observedMin!==Number.POSITIVE_INFINITY&&(t[r].min=t[r].observedMin,t[r].max=t[r].observedMax,t[r].index===-1&&(t[r].title=f(t[r].min,t[r].max)))},e=function(n,t,i){return n===t?n:{title:f(n.min,t.max),min:n.min,max:t.max,hours:i,color:t.color,pulled:!0,index:-1}},et=function(n,t){for(var u=[],o=.5*(1/n.length),r=0,f=0,i=0;i<n.length;i++){if(n[i].hours/t<o){f+=n[i].hours;continue}i>r&&u.push(e(n[r],n[i-1],f));u.push(n[i]);r=i+1;f=0}return r<n.length&&u.push(e(n[r],n[n.length-1],f)),u},ot=function(n,t,i){for(var h,o,c,r=[],s=Math.ceil((t.max-t.min+1)/i),u=t.min;u<=t.max;u=u+s)h=Math.min(t.max,u+s-1),r.push({title:f(u,h),min:u,max:h,hours:0,color:t.color,pulled:!0,index:-1});return o=r[r.length-1],r.length>1&&o.max-o.min<s/2&&(c=r[r.length-2],r.splice(r.length-2,2,e(c,o,0))),v(n,r),et(r,t.hours)},st=function(n){for(var t=0;t<n.length;t++)n[t].hours=0,n[t].color=progressivePalette[t%progressivePalette.length],n[t].pulled=!1,n[t].description=" ("+n[t].min+"-"+n[t].max+")",n[t].index=t;n.push({title:r,min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY,hours:0,color:unknownColor,pulled:!1,index:n.length})},y=function(n,t,i,u){var e=typeof u!="undefined",o,s,f,h;if(e&&(f=u.dataContext),e&&f.title===r){u.pulled&&n.clickSlice(u.index);return}st(i);o={};s=e&&f.index!==-1;v(t,i,s?function(n,t,i){n.index===f.index&&(o[t]=i)}:undefined);s&&(f=i[f.index],h=Math.round(f.hours/a()*10)+2,i.splice.apply(i,[f.index,1].concat(ot(o,f,h))));n.dataProvider=i;n.validateData()},p=function(t,i){y(n.metacriticChart,t.playtimesByMetacritic,[{title:"Overwhelming Dislike",min:0,max:19},{title:"Generally Unfavorable",min:20,max:49},{title:"Mixed or Average",min:50,max:74},{title:"Generally Favorable",min:75,max:89},{title:"Universal Acclaim",min:90,max:100}],i)},ht=function(t){u(n.genreChart,t.playtimesByGenre)},ct=function(t){u(n.appTypeChart,t.playtimesByAppType)},lt=function(t){u(n.platformChart,t.playtimesByPlatform)},w=function(t,i){for(var u=[],f=(new Date).getFullYear(),r=1980;r<=f;r+=10)u.push({title:r.toString().substring(2)+"s",min:r,max:r+9});y(n.releaseDateChart,t.playtimesByReleaseYear,u,i)},at=function(n){ht(n);p(n);ct(n);lt(n);w(n)},b=function(n){ut(n);at(n)},k=function(n){var t=$("#"+n);t.height(t.width()*2/3)},d=function(n,t){return k(n),AmCharts.makeChart(n,{type:"serial",theme:"light",colors:alternatingPalette,dataProvider:t,categoryField:"playtime",valueAxes:[{axisAlpha:0,position:"left",title:"Hours"}],categoryAxis:{gridPosition:"start"},graphs:[{type:"column",valueField:"hours",colorField:"color",lineThickness:1.5,balloonText:"<b>[[value]] hours<\/b>",fillAlphas:.5,lineAlpha:.8}],precision:0,startDuration:1,responsive:{enabled:!0}})},i=function(t,i,r){k(t);var u=AmCharts.makeChart(t,{type:"pie",theme:"light",colors:alternatingPalette,marginLeft:0,marginRight:0,marginBottom:15,marginTop:i,pullOutRadius:"5%",valueField:"hours",colorField:"color",descriptionField:"description",pulledField:"pulled",precision:0,titleField:"title",labelRadius:10,labelText:"[[title]]",balloonText:"[[title]][[description]]: [[percents]]% ([[value]] hours)",balloon:{maxWidth:$("#"+t).width()*2/3},startDuration:0,responsive:{enabled:!0}});return typeof r!="undefined"&&u.addListener("clickSlice",function(t){r(n.total(),t.dataItem)}),u},g=!0,vt=function(){if(!g){n.playtimeChart.animateAgain();n.remainingChart.animateAgain();return}g=!1;n.playtimeChart=d("playtimeChart",[{playtime:"Current",hours:0},{playtime:"Main",hours:0},{playtime:"Extras",hours:0},{playtime:"Complete",hours:0}]);n.remainingChart=d("remainingChart",[{playtime:"Main",hours:0},{playtime:"Extras",hours:0},{playtime:"Complete",hours:0}]);n.genreChart=i("genreChart",25);n.metacriticChart=i("metacriticChart",25,p);n.appTypeChart=i("appTypeChart",40);n.platformChart=i("platformChart",40);n.releaseDateChart=i("releaseDateChart",40,w);n.total.subscribe(b);n.sliceTotal.subscribe(function(t){t||n.sliceCompletionLevel()!==PlaytimeType.Current||n.sliceCompletionLevel(PlaytimeType.Main)});b(n.total())},nt=function(){setTimeout(function(){$("html, body").animate({scrollTop:$("#alerts").offset().top-10},800)},200)},yt=function(){n.processing(!0);var t=$(window).height();$(".loader").spin({lines:14,length:Math.ceil(t/25),width:Math.ceil(t/90),radius:Math.ceil(t/15)})},o=function(){n.processing(!1);$(".loader").spin(!1)},s=0,h=!1,c=!0;n.rowRendered=function(){var i,t,r,u;if(h&&(s++,!(s<Math.min(n.gameTable.perPage(),n.gameTable.filteredRows().length)))){if(h=!1,vt(),!c){nt();return}i=$("#gameTable").width();t=0;$.each($("table th.compressed"),function(){var n=$(this).width()+10;t+=n;$(this).css("width",n+"px")});r=$("table th.expanded").size();u=(i-t)/r;$("table th.expanded").css("width",u+"px");$("#gameTable").css("table-layout","fixed");c=!1;o();nt()}};tt=function(t){for(var i,u=new Array(t.length),f=!1,e=!1,r=0;r<t.length;r++)i=new Game(t[r]),f||i.known?!e&&(i.hltbMainTtbImputed||i.hltbExtrasTtbImputed||i.hltbCompletionistTtbImputed)&&(n.imputedTtbs(!0),e=!0):(n.missingHltbIds(!0),n.imputedTtbs(!0),f=!0),u[r]=i;return u};n.loadGames=function(){n.currentRequest!==undefined&&n.currentRequest.abort();$("#content").hide();yt();n.error(!1);n.partialCache(!1);n.imputedTtbs(!1);n.missingHltbIds(!1);n.sliceTotal(!1);n.sliceCompletionLevel(PlaytimeType.Main);n.gameTable.filter("");n.gameTable.toggleSort("");n.bonusLinkVisible(n.steamVanityUrlName().indexOf("cached/")===-1);n.currentRequest=$.get("api/games/library/"+n.steamVanityUrlName()).done(function(t){h=!0;includedObservable(!0);n.partialCache(t.PartialCache);n.initialTotal={count:t.Games.length,playtime:t.Totals.Playtime,mainTtb:t.Totals.MainTtb,extrasTtb:t.Totals.ExtrasTtb,completionistTtb:t.Totals.CompletionistTtb,mainRemaining:t.Totals.MainRemaining,extrasRemaining:t.Totals.ExtrasRemaining,completionistRemaining:t.Totals.CompletionistRemaining,playtimesByGenre:t.Totals.PlaytimesByGenre,playtimesByMetacritic:t.Totals.PlaytimesByMetacritic,playtimesByAppType:t.Totals.PlaytimesByAppType,playtimesByPlatform:t.Totals.PlaytimesByPlatform,playtimesByReleaseYear:t.Totals.PlaytimesByReleaseYear};n.gameTable.rows(tt(t.Games));n.originalMainRemaining=n.total().mainRemaining;n.gameTable.rows().length>0&&($("#content").show(),n.gameTable.currentPageNumber(1),s=0);c&&n.gameTable.rows().length!==0||o()}).fail(function(t){console.error(t);n.gameTable.rows([]);n.error(!0);o()}).always(function(){n.alertHidden(!1);n.missingAlertHidden(!1);n.errorAlertHidden(!1)})};n.displayUpdateDialog=function(t){n.gameToUpdate(t);$("#HltbUpdateModal").modal("show")};n.updateHltb=function(n){n.updatePhase(GameUpdatePhase.InProgress);$.post("api/games/update/"+n.steamAppId+"/"+n.suggestedHltbId()).done(function(){n.updatePhase(GameUpdatePhase.Success)}).fail(function(t){console.error(t);n.updatePhase(GameUpdatePhase.Failure)});$("#HltbUpdateModal").modal("hide")};n.getShortShareText=function(){return"I just found out I have over "+hoursWithCommas(n.originalMainRemaining)+" left to beat my entire Steam library!"};n.getShareText=function(){return n.getShortShareText()+" Click to check it out and find out how long you have too..."};n.shareOnFacebook=function(){n.openShareWindow("https://www.facebook.com/dialog/feed?app_id=445487558932250&display=popup&caption=HowLongToBeatSteam.com&description="+encodeURIComponent(n.getShareText())+"&link="+encodeURIComponent(window.location.href)+"&redirect_uri="+encodeURIComponent("http://howlongtobeatsteam.com/CloseWindow.html")+"&picture="+encodeURIComponent("http://howlongtobeatsteam.com/Resources/sk5_0.jpg"))};n.shareOnTwitter=function(){n.openShareWindow("https://twitter.com/share?url="+encodeURIComponent(window.location.href)+"&text="+n.getShortShareText()+"&hashtags=hltbs,steam")};n.shareOnGooglePlus=function(){n.openShareWindow("https://plus.google.com/share?url="+encodeURIComponent(window.location.href))};n.openShareWindow=function(n){window.open(n,"share","toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=600,height=600")}}var getOrderedOwnProperties=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t.sort(),t},getHours=function(n,t){t===undefined&&(t=2);var i=Math.max(n,0)/60;return+i.toFixed(t)},numberWithCommas=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},timeWithCommas=function(n,t){return numberWithCommas(n)+" "+(n===1?t:t+"s")},hoursWithCommas=function(n){var t=getHours(n,0);return timeWithCommas(t,"hour")},getYears=function(n){return countdown(null,{minutes:n},countdown.YEARS|countdown.MONTHS|countdown.WEEKS|countdown.DAYS|countdown.HOURS).toString("0 hours")},GameUpdatePhase={None:"None",InProgress:"InProgress",Success:"Success",Failure:"Failure"},PlaytimeType={Current:"current",Main:"main",Extras:"extras",Completionist:"completionist"},alternatingPalette=[],progressivePalette=["#75c7f0","#6CC3EF","#6CC3EF","#5ABCED","#47B4EB","#35ADE9","#23A5E7","#189BDC","#168ECA","#1481B8"],unknownColor="#ABB5BA",slashRegex=new RegExp("/","g"),genreSeparatorReplacer=function(n){return n.replace(slashRegex,"-")},includedObservable=ko.observable(!0),updatePhaseObservable=ko.observable(GameUpdatePhase.None),zeroObservable=ko.observable(0);Game.prototype.match=function(n){return this.steamName.toLowerCase().indexOf(n.toLowerCase())!==-1};$(document).ready(function(){var t,i,n,r;for(window.console||(t=function(){},window.console={log:t,warn:t,error:t}),i=0;i<50;i++)alternatingPalette.push("#97BBCD","#75C7F0");$('[data-toggle="tooltip"]').tooltip();$("#steamIdText").focus();n=new AppViewModel;ko.applyBindings(n);r=$.sammy(function(){this.get("#/",function(){n.introPage(!0)});var t=function(t){n.introPage(!1);n.steamVanityUrlName(t);n.loadGames()};this.get("#/:vanityUrlName",function(){t(this.params.vanityUrlName)});this.get("#/cached/:count",function(){t("cached/"+this.params.count)})});r.run("#/")});
//# sourceMappingURL=app.min.js.map
