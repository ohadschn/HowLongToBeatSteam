function Game(n){var t=this,i,r;t.included=ko.observable(!0);t.updatePhase=ko.observable(GameUpdatePhase.None);t.steamPlaytime=n.Playtime;i=n.SteamAppData;t.steamAppId=i.SteamAppId;t.steamName=i.SteamName;t.steamUrl="http://store.steampowered.com/app/"+i.SteamAppId;t.appType=i.AppType;t.platforms=i.Platforms;t.categories=i.Categories;t.genres=ko.utils.arrayMap(i.Genres,function(n){return n.replace(new RegExp("/","g"),"-")});t.developers=i.Developers;t.publishers=i.Publishers;t.releaseDate=i.ReleaseDate;t.metaCriticScore=i.MetaCriticScore;r=i.HltbInfo;t.known=r.Id!==-1;t.hltbOriginalId=t.known?r.Id:"";t.hltbId=ko.observable(t.known?r.Id:"");t.suggestedHltbId=ko.observable(t.hltbId());t.hltbName=t.known?r.Name:"";t.hltbMainTtb=r.MainTtb;t.hltbMainTtbImputed=r.MainTtbImputed;t.hltbExtrasTtb=r.ExtrasTtb;t.hltbExtrasTtbImputed=r.ExtrasTtbImputed;t.hltbCompletionistTtb=r.CompletionistTtb;t.hltbCompletionistTtbImputed=r.CompletionistTtbImputed;t.hltbUrl=t.known?"http://www.howlongtobeat.com/game.php?id="+r.Id:"http://www.howlongtobeat.com"}function AppViewModel(){var n=this,r;n.steamVanityUrlName=ko.observable("");r={recordWord:"game",sortDir:"asc",sortField:"steamName",perPage:10,unsortedClass:"glyphicon glyphicon-sort",ascSortClass:"glyphicon glyphicon-sort-by-attributes",descSortClass:"glyphicon glyphicon-sort-by-attributes-alt"};n.introPage=ko.observable(!0);n.gameTable=new DataTable([],r);n.pageSizeOptions=[10,25,50];n.sliceTotal=ko.observable();n.sliceCompletionLevel=ko.observable();n.partialCache=ko.observable(!1);n.imputedTtbs=ko.observable(!1);n.missingHltbIds=ko.observable(!1);n.processing=ko.observable(!1);n.error=ko.observable(!1);n.alertHidden=ko.observable(!1);n.missingAlertHidden=ko.observable(!1);n.errorAlertHidden=ko.observable(!1);n.gameToUpdate=ko.observable({steamAppId:0,steamName:"",hltbId:ko.observable(""),suggestedHltbId:ko.observable("")});n.toggleAllChecked=ko.observable(!0);n.toggleAllCore=function(t){ko.utils.arrayForEach(n.gameTable.rows(),function(n){n.included(t)})};n.toggleAll=function(){return n.toggleAllCore(!n.toggleAllChecked()),!0};n.previousIds=[];n.prevTotal={count:0,playtime:0,mainTtb:0,extrasTtb:0,completionistTtb:0,mainRemaining:0,extrasRemaining:0,completionistRemaining:0,playtimesByGenre:{}};n.total=ko.pureComputed(function(){var u=0,c=0,l=0,a=0,v=0,y=0,p=0,w=0,i={},g=n.gameTable.filteredRows().length,e=ko.utils.arrayFilter(n.gameTable.filteredRows(),function(n){return n.included()}),o=ko.utils.arrayMap(e,function(n){return n.steamAppId}),f,t,s,r,h;if($(o).not(n.previousIds).length===0&&$(n.previousIds).not(o).length===0)return n.prevTotal.orderChange=!0,n.prevTotal;for(f=0;f<e.length;++f){t=e[f];u++;c+=t.steamPlaytime;l+=t.hltbMainTtb;a+=t.hltbExtrasTtb;v+=t.hltbCompletionistTtb;var b=Math.max(0,t.hltbMainTtb-t.steamPlaytime),k=Math.max(0,t.hltbExtrasTtb-t.steamPlaytime),d=Math.max(0,t.hltbCompletionistTtb-t.steamPlaytime);y+=b;p+=k;w+=d;s=$(t.genres).not(["Indie","Casual"]).get();r=(s.length===0?t.genres:s).join("/");i.hasOwnProperty(r)||(i[r]=[0,0,0,0,0,0,0]);i[r][0]+=t.steamPlaytime;i[r][1]+=t.hltbMainTtb;i[r][2]+=t.hltbExtrasTtb;i[r][3]+=t.hltbCompletionistTtb;i[r][4]+=b;i[r][5]+=k;i[r][6]+=d}return u===g?n.toggleAllChecked(!0):u===0&&n.toggleAllChecked(!1),h={count:u,playtime:c,mainTtb:l,extrasTtb:a,completionistTtb:v,mainRemaining:y,extrasRemaining:p,completionistRemaining:w,playtimesByGenre:i},n.previousIds=o,n.prevTotal=h,h}).extend({rateLimit:0});var u=1e3,s=function(){$("html, body").animate({scrollTop:$("#content").offset().top-10},.75*u)},f=!0;n.tableRendered=function(){f&&$("#gameTable tbody").children().length===n.gameTable.perPage()&&(f=!1,setTimeout(function(){var r=$("#gameTable").width(),n=0,t,i;$.each($("table th.compressed"),function(){var t=$(this).width()+10;n+=t;$(this).css("width",t+"px")});t=$("table th.expanded").size();i=(r-n)/t;$("table th.expanded").css("width",i+"px");$("#gameTable").css("table-layout","fixed")},u/2))};n.vanityUrlSubmitted=function(){window.location.hash==="#/"+n.steamVanityUrlName()&&n.loadGames()};var h=function(t){n.playtimeChart.dataProvider[0].hours=getHours(t.playtime,0);n.playtimeChart.dataProvider[1].hours=getHours(t.mainTtb,0);n.playtimeChart.dataProvider[2].hours=getHours(t.extrasTtb,0);n.playtimeChart.dataProvider[3].hours=getHours(t.completionistTtb,0);n.playtimeChart.validateData();n.remainingChart.dataProvider[0].hours=getHours(t.mainRemaining,0);n.remainingChart.dataProvider[1].hours=getHours(t.extrasRemaining,0);n.remainingChart.dataProvider[2].hours=getHours(t.completionistRemaining,0);n.remainingChart.validateData()},c=function(){var t,i;switch(n.sliceCompletionLevel()){case PlaytimeType.Current:t=n.sliceTotal()?0:4;i=n.sliceTotal()?n.total().playtime:n.total().mainRemaining;break;case PlaytimeType.Main:t=n.sliceTotal()?1:4;i=n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining;break;case PlaytimeType.Extras:t=n.sliceTotal()?2:5;i=n.sliceTotal()?n.total().extrasTtb:n.total().extrasRemaining;break;case PlaytimeType.Completionist:t=n.sliceTotal()?3:6;i=n.sliceTotal()?n.total().completionistTtb:n.total().completionistRemaining;break;default:console.error("Invalid playtime slice type: "+n.sliceCompletionLevel());t=n.sliceTotal()?1:4;i=n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining}return{index:t,total:getHours(i,0)}},l=function(n,t){var o=getOrderedOwnProperties(t),s=c(),i,e,u,r,f;for(n.dataProvider=[],i=[],e=0,u=0;u<o.length;u++){if(r=o[u],f=getHours(t[r][s.index],0),r==="Unknown"||f/s.total<.01){i.push(r);e+=f;continue}n.dataProvider.push({title:r,hours:f})}i.length>=1&&n.dataProvider.push({title:i.length===1&&i[0]!=="Unknown"?i[0]:"Other",hours:e});n.validateData()},t=function(t){l(n.genreChart,t.playtimesByGenre)},e=function(n){n.orderChange!==!0&&(h(n),t(n))},i=function(n){var t=$("#"+n);t.height(t.width()*2/3)},o=!0,a=function(){var u,f,r;if(!o){n.playtimeChart.animateAgain();n.remainingChart.animateAgain();n.genreChart.animateAgain();return}o=!1;u={axisAlpha:0,position:"left",title:"Hours"};f={type:"column",valueField:"hours",colorField:"color",lineColor:mainColor,lineThickness:1.5,balloonText:"<b>[[value]] hours<\/b>",fillAlphas:.5,lineAlpha:.8};i("playtimeChart");r=mainColor;n.playtimeChart=AmCharts.makeChart("playtimeChart",{type:"serial",theme:"light",dataProvider:[{playtime:"Current",hours:0,color:r},{playtime:"Main",hours:0,color:r},{playtime:"Extras",hours:0,color:r},{playtime:"Complete",hours:0,color:r}],categoryField:"playtime",valueAxes:[u],categoryAxis:{gridPosition:"start"},graphs:[f],startDuration:1});i("remainingChart");n.remainingChart=AmCharts.makeChart("remainingChart",{type:"serial",theme:"light",dataProvider:[{playtime:"Main",hours:0,color:r},{playtime:"Extras",hours:0,color:r},{playtime:"Complete",hours:0,color:r}],categoryField:"playtime",valueAxes:[u],categoryAxis:{gridPosition:"start"},graphs:[f],startDuration:1});i("genreChart");n.genreChart=AmCharts.makeChart("genreChart",{type:"pie",theme:"light",colors:duplicate(palette,50),valueField:"hours",titleField:"title",labelRadius:10,labelText:"[[title]]",balloonText:"[[title]]: [[percents]]% ([[value]] hours)\n[[description]]",balloon:{maxWidth:$("#genreChart").width()*2/3}});n.total.subscribe(e);n.sliceCompletionLevel.subscribe(function(){t(n.total())});n.sliceTotal.subscribe(function(i){i||n.sliceCompletionLevel()!==PlaytimeType.Current?t(n.total()):n.sliceCompletionLevel(PlaytimeType.Main)});e(n.total())};n.loadGames=function(){n.currentRequest!==undefined&&n.currentRequest.abort();$(".content").hide();var t=$(window).height();$(".loader").spin({lines:14,length:Math.ceil(t/25),width:Math.ceil(t/90),radius:Math.ceil(t/15)});n.error(!1);n.processing(!0);n.partialCache(!1);n.imputedTtbs(!1);n.missingHltbIds(!1);n.sliceTotal(!0);n.sliceCompletionLevel(PlaytimeType.Main);n.gameTable.filter("");n.currentRequest=$.get("api/games/library/"+n.steamVanityUrlName()).done(function(t){n.partialCache(t.PartialCache);n.gameTable.rows(ko.utils.arrayMap(t.Games,function(t){var i=new Game(t);return i.known?(i.hltbMainTtbImputed||i.hltbExtrasTtbImputed||i.hltbCompletionistTtbImputed)&&n.imputedTtbs(!0):(n.missingHltbIds(!0),n.imputedTtbs(!0)),i}));n.originalMainRemaining=n.total().mainRemaining;$(".content").show();n.alertHidden(!1);a();s()}).fail(function(t){console.error(t);n.gameTable.rows([]);n.error(!0)}).always(function(){n.processing(!1);n.alertHidden(!1);n.missingAlertHidden(!1);n.errorAlertHidden(!1);$(".loader").spin(!1)})};n.displayUpdateDialog=function(t){n.gameToUpdate(t);$("#HltbUpdateModal").modal("show")};n.updateHltb=function(n){n.updatePhase(GameUpdatePhase.InProgress);$.post("api/games/update/"+n.steamAppId+"/"+n.suggestedHltbId()).done(function(){n.updatePhase(GameUpdatePhase.Success)}).fail(function(t){console.error(t);n.updatePhase(GameUpdatePhase.Failure)});$("#HltbUpdateModal").modal("hide")};n.allowUpdate=function(n){return n.updatePhase()===GameUpdatePhase.None||n.updatePhase()===GameUpdatePhase.Failure};n.getShortShareText=function(){return"I just found out I have over "+hoursWithCommas(n.originalMainRemaining)+" left to beat my entire Steam library!"};n.getShareText=function(){return n.getShortShareText()+" Click to check it out and find out how long you have too..."};n.shareOnFacebook=function(){n.openShareWindow("https://www.facebook.com/dialog/feed?app_id=445487558932250&display=popup&caption=HowLongToBeatSteam.com&description="+encodeURIComponent(n.getShareText())+"&link="+encodeURIComponent(window.location.href)+"&redirect_uri="+encodeURIComponent("http://howlongtobeatsteam.com/CloseWindow.html")+"&picture="+encodeURIComponent("http://howlongtobeatsteam.com/Resources/sk5_0.jpg"))};n.shareOnTwitter=function(){n.openShareWindow("https://twitter.com/share?url="+encodeURIComponent(window.location.href)+"&text="+n.getShortShareText()+"&hashtags=hltbs,steam")};n.shareOnGooglePlus=function(){n.openShareWindow("https://plus.google.com/share?url="+encodeURIComponent(window.location.href))};n.openShareWindow=function(n){window.open(n,"share","toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=600,height=600")}}var getOrderedOwnProperties=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t.sort(),t},duplicate=function(n,t){for(var i=n,r=0;r<t-1;r++)i=i.concat(n);return i},getHours=function(n,t){t===undefined&&(t=2);var i=Math.max(n,0)/60;return+i.toFixed(t)},numberWithCommas=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},timeWithCommas=function(n,t){return numberWithCommas(n)+" "+(n===1?t:t+"s")},hoursWithCommas=function(n){var t=getHours(n,0);return timeWithCommas(t,"hour")},getYears=function(n){return countdown(null,{minutes:n},countdown.YEARS|countdown.MONTHS|countdown.WEEKS|countdown.DAYS|countdown.HOURS).toString("0 hours")},GameUpdatePhase={None:"None",InProgress:"InProgress",Success:"Success",Failure:"Failure"},PlaytimeType={Current:"current",Main:"main",Extras:"extras",Completionist:"completionist"},mainColor="#97BBCD",palette=[mainColor,"#75C7F0"];Game.prototype.match=function(n){return this.steamName.toLowerCase().indexOf(n.toLowerCase())!==-1};$(document).ready(function(){var t,n,i;window.console||(t=function(){},window.console={log:t,warn:t,error:t});$('[data-toggle="tooltip"]').tooltip();$("#steamIdText").focus();n=new AppViewModel;ko.applyBindings(n);i=$.sammy(function(){this.get("#/",function(){n.introPage(!0)});this.get("#/:vanityUrlName",function(){n.introPage(!1);n.steamVanityUrlName(this.params.vanityUrlName);n.loadGames()})});i.run("#/")});
//# sourceMappingURL=app.min.js.map
