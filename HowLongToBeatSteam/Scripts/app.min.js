function Game(n){var t=this;t.known=n.HltbInfo.Id!==-1;t.included=ko.observable(!0);t.updatePhase=ko.observable(GameUpdatePhase.None);t.steamAppId=n.SteamAppId;t.steamName=n.SteamName;t.steamPlaytime=n.Playtime;t.steamUrl="http://store.steampowered.com/app/"+n.SteamAppId;t.hltbOriginalId=t.known?n.HltbInfo.Id:"";t.hltbId=ko.observable(t.known?n.HltbInfo.Id:"");t.hltbName=ko.observable(t.known?n.HltbInfo.Name:"Unknown; please update");t.hltbMainTtb=n.HltbInfo.MainTtb;t.hltbMainTtbImputed=n.HltbInfo.MainTtbImputed;t.hltbExtrasTtb=n.HltbInfo.ExtrasTtb;t.hltbExtrasTtbImputed=n.HltbInfo.ExtrasTtbImputed;t.hltbCompletionistTtb=n.HltbInfo.CompletionistTtb;t.hltbCompletionistTtbImputed=n.HltbInfo.CompletionistTtbImputed;t.hltbUrl=t.known?"http://www.howlongtobeat.com/game.php?id="+n.HltbInfo.Id:"http://www.howlongtobeat.com"}function AppViewModel(){var n=this,u,r,t,i;n.steamVanityUrlName=ko.observable();n.badSteamVanityUrlName=ko.observable(!1);$("#steamIdText").keydown(function(){n.badSteamVanityUrlName(!1)});u={recordWord:"game",sortDir:"asc",sortField:"steamName",perPage:10,unsortedClass:"glyphicon glyphicon-sort",ascSortClass:"glyphicon glyphicon-sort-by-attributes",descSortClass:"glyphicon glyphicon-sort-by-attributes-alt"};n.introPage=ko.observable(!0);n.gameTable=new DataTable([],u);n.pageSizeOptions=[10,25,50];n.partialCache=ko.observable(!1);n.imputedTtbs=ko.observable(!1);n.missingHltbIds=ko.observable(!1);n.processing=ko.observable(!1);n.error=ko.observable(null);n.alertHidden=ko.observable(!0);n.errorAlertHidden=ko.observable(!1);n.toggleAllChecked=ko.observable(!0);n.toggleAllCore=function(t){ko.utils.arrayForEach(n.gameTable.rows(),function(n){n.included(t)})};n.toggleAll=function(){return n.toggleAllCore(!n.toggleAllChecked()),!0};n.total=ko.pureComputed(function(){for(var t,i=0,u=0,f=0,e=0,o=0,s=0,h=0,c=0,l=n.gameTable.filteredRows().length,a=n.gameTable.filteredRows(),r=0;r<l;++r)(t=a[r],t.included())&&(i++,u+=t.steamPlaytime,f+=t.hltbMainTtb,e+=t.hltbExtrasTtb,o+=t.hltbCompletionistTtb,s+=Math.max(0,t.hltbMainTtb-t.steamPlaytime),h+=Math.max(0,t.hltbExtrasTtb-t.steamPlaytime),c+=Math.max(0,t.hltbCompletionistTtb-t.steamPlaytime));return i===l?n.toggleAllChecked(!0):i===0&&n.toggleAllChecked(!1),{count:i,playTime:u,mainTtb:f,extrasTtb:e,completionistTtb:o,mainRemaining:s,extrasRemaining:h,completionistRemaining:c}}).extend({rateLimit:0});Chart.defaults.global.tooltipTemplate="<%= value %> hours";Chart.defaults.global.responsive=!0;r={fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[0,0,0,0]};t=new Chart($("#playtimeChart").get(0).getContext("2d")).Bar({labels:["Current","Main","Extras","Complete"],datasets:[r]});r.data=[0,0,0];i=new Chart($("#remainingChart").get(0).getContext("2d")).Bar({labels:["Main","Extras","Complete"],datasets:[r]});n.total.subscribe(function(n){t.datasets[0].bars[0].value=getHours(n.playTime,0);t.datasets[0].bars[1].value=getHours(n.mainTtb,0);t.datasets[0].bars[2].value=getHours(n.extrasTtb,0);t.datasets[0].bars[3].value=getHours(n.completionistTtb,0);t.update();i.datasets[0].bars[0].value=getHours(n.mainRemaining,0);i.datasets[0].bars[1].value=getHours(n.extrasRemaining,0);i.datasets[0].bars[2].value=getHours(n.completionistRemaining,0);i.update()});var f=1e3,o=function(){$("html, body").animate({scrollTop:$("#alertContainer").offset().top-10},f)},e=!0;n.tableRendered=function(){e&&$("#gameTable tbody").children().length===n.gameTable.perPage()&&(e=!1,setTimeout(function(){var r=$("#gameTable").width(),n=0,t,i;$.each($("table th.compressed"),function(){var t=$(this).width()+10;n+=t;$(this).css("width",t+"px")});t=$("table th.expanded").size();i=(r-n)/t;$("table th.expanded").css("width",i+"px");$("#gameTable").css("table-layout","fixed")},f/2))};n.vanityUrlSubmitted=function(){window.location.hash==="#/"+n.steamVanityUrlName()&&n.loadGames()};n.loadGames=function(){if(n.currentRequest!==undefined&&n.currentRequest.abort(),$(".loader").spin({lines:12,length:35,width:8,radius:50}),n.steamVanityUrlName().length===0){n.badSteamVanityUrlName(!0);n.error("Please specify your Steam Profile ID");return}n.error(null);n.processing(!0);n.partialCache(!1);n.imputedTtbs(!1);n.missingHltbIds(!1);n.alertHidden(!0);n.errorAlertHidden(!1);n.gameTable.filter("");n.currentRequest=$.get("api/games/library/"+n.steamVanityUrlName()).done(function(t){n.partialCache(t.PartialCache);n.gameTable.rows(ko.utils.arrayMap(t.Games,function(t){var i=new Game(t);return i.known?(i.hltbMainTtbImputed||i.hltbExtrasTtbImputed||i.hltbCompletionistTtbImputed)&&n.imputedTtbs(!0):(n.missingHltbIds(!0),n.imputedTtbs(!0)),i}));n.alertHidden(!1);o()}).fail(function(t){console.error(t);n.gameTable.rows([]);n.error('verify your Steam profile ID and make sure it is set to "public" in your Steam profile settings')}).always(function(){n.processing(!1);$(".loader").spin(!1)})};n.updateHltb=function(n){n.hltbName("Updating...");n.updatePhase(GameUpdatePhase.InProgress);$.post("api/games/update/"+n.steamAppId+"/"+n.hltbId()).done(function(){n.hltbName("Update submitted for approval, please check back later");n.updatePhase(GameUpdatePhase.Success)}).fail(function(t){console.error(t);n.hltbName("Update failed, please verify the HLTB ID");n.updatePhase(GameUpdatePhase.Failure)})};n.allowUpdate=function(n){return n.updatePhase()===GameUpdatePhase.None||n.updatePhase()===GameUpdatePhase.Failure}}var getHours=function(n,t){t===undefined&&(t=2);var i=Math.max(n,0)/60;return+i.toFixed(t)},numberWithCommas=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},GameUpdatePhase={None:"None",InProgress:"InProgress",Success:"Success",Failure:"Failure"};Game.prototype.match=function(n){return this.steamName.toLowerCase().indexOf(n.toLowerCase())!==-1};$(document).ready(function(){var t,n,i;window.console||(t=function(){},window.console={log:t,warn:t,error:t});$('[data-toggle="tooltip"]').tooltip();$("#steamIdText").focus();n=new AppViewModel;ko.applyBindings(n);i=$.sammy(function(){this.get("#/",function(){n.introPage(!0);$.backstretch("http://res2.windows.microsoft.com/resbox/en/windows%207/main/b1697ff2-4fef-4125-a4c4-f3dcaa68a0aa_12.jpg")});this.get("#/:vanityUrlName",function(){n.introPage(!1);$(document.body).data("backstretch")!==undefined&&$.backstretch("destroy",!1);n.steamVanityUrlName(this.params.vanityUrlName);n.loadGames()})});i.run("#/")});
//# sourceMappingURL=app.min.js.map
