"use strict";function Game(n){var t=this,r,i;t.included=trueObservable;t.updatePhase=updatePhaseObservable;t.steamPlaytime=n.Playtime;r=n.SteamAppData;t.steamAppId=r.SteamAppId;t.steamName=r.SteamName;t.genres=ko.utils.arrayMap(r.Genres,genreSeparatorReplacer);t.metacriticScore=r.MetacriticScore;i=r.HltbInfo;t.known=i.Id!==-1;t.hltbId=t.known?i.Id:"";t.suggestedHltbId=zeroObservable;t.hltbName=t.known?i.Name:"";t.hltbMainTtb=i.MainTtb;t.hltbMainTtbImputed=i.MainTtbImputed;t.hltbExtrasTtb=i.ExtrasTtb;t.hltbExtrasTtbImputed=i.ExtrasTtbImputed;t.hltbCompletionistTtb=i.CompletionistTtb;t.hltbCompletionistTtbImputed=i.CompletionistTtbImputed}function AppViewModel(){var n=this,o,t,b;n.steamVanityUrlName=ko.observable("");o={recordWord:"game",sortDir:"asc",perPage:10,unsortedClass:"glyphicon glyphicon-sort",ascSortClass:"glyphicon glyphicon-sort-by-attributes",descSortClass:"glyphicon glyphicon-sort-by-attributes-alt"};n.introPage=ko.observable(!0);n.gameTable=new DataTable([],o);n.pageSizeOptions=[10,25,50];n.sliceTotal=ko.observable();n.sliceCompletionLevel=ko.observable();n.partialCache=ko.observable(!1);n.imputedTtbs=ko.observable(!1);n.missingHltbIds=ko.observable(!1);n.processing=ko.observable(!1);n.error=ko.observable(!1);n.alertHidden=ko.observable(!1);n.missingAlertHidden=ko.observable(!1);n.errorAlertHidden=ko.observable(!1);n.gameToUpdate=ko.observable({steamAppId:0,steamName:"",hltbId:"",suggestedHltbId:ko.observable("")});n.toggleAllChecked=ko.observable(!0);n.toggleAllCore=function(t){for(var r=n.gameTable.rows(),i=0;i<r.length;i++)r[i].included(t)};n.toggleAll=function(){return n.toggleAllCore(!n.toggleAllChecked()),!0};t=function(n,t,i,r,u,f){n.hasOwnProperty(t)||(n[t]=[0,0,0,0,0,0,0]);var e=n[t];e[0]+=i.steamPlaytime;e[1]+=i.hltbMainTtb;e[2]+=i.hltbExtrasTtb;e[3]+=i.hltbCompletionistTtb;e[4]+=r;e[5]+=u;e[6]+=f};n.total=ko.pureComputed(function(){for(var i,s,d,r=0,h=0,c=0,l=0,a=0,v=0,y=0,p=0,w={},b={},g=n.gameTable.filteredRows().length,k=ko.utils.arrayFilter(n.gameTable.filteredRows(),function(n){return n.included()}),u=0;u<k.length;++u){i=k[u];r++;h+=i.steamPlaytime;c+=i.hltbMainTtb;l+=i.hltbExtrasTtb;a+=i.hltbCompletionistTtb;var f=Math.max(0,i.hltbMainTtb-i.steamPlaytime),e=Math.max(0,i.hltbExtrasTtb-i.steamPlaytime),o=Math.max(0,i.hltbCompletionistTtb-i.steamPlaytime);v+=f;y+=e;p+=o;s=ko.utils.arrayFilter(i.genres,function(n){return n!=="Indie"&&n!=="Casual"});d=(s.length===0?i.genres:s).join("/");t(w,d,i,f,e,o);t(b,i.metacriticScore,i,f,e,o)}return r===g?n.toggleAllChecked(!0):r===0&&n.toggleAllChecked(!1),{count:r,playtime:h,mainTtb:c,extrasTtb:l,completionistTtb:a,mainRemaining:v,extrasRemaining:y,completionistRemaining:p,playtimesByGenre:w,playtimesByMetacritic:b}}).extend({rateLimit:0});n.pagedGames=ko.pureComputed(function(){for(var t,i=n.gameTable.pagedRows(),u=!1,r=0;r<i.length;r++)t=i[r],t.included===trueObservable&&(t.included=ko.observable(trueObservable()),t.updatePhase=ko.observable(updatePhaseObservable()),t.suggestedHltbId=ko.observable(t.hltbId),u=!0);return u&&trueObservable.valueHasMutated(),i});n.vanityUrlSubmitted=function(){window.location.hash==="#/"+n.steamVanityUrlName()&&n.loadGames()};var k=function(t){n.playtimeChart.dataProvider[0].hours=getHours(t.playtime);n.playtimeChart.dataProvider[1].hours=getHours(t.mainTtb);n.playtimeChart.dataProvider[2].hours=getHours(t.extrasTtb);n.playtimeChart.dataProvider[3].hours=getHours(t.completionistTtb);n.playtimeChart.validateData();n.remainingChart.dataProvider[0].hours=getHours(t.mainRemaining);n.remainingChart.dataProvider[1].hours=getHours(t.extrasRemaining);n.remainingChart.dataProvider[2].hours=getHours(t.completionistRemaining);n.remainingChart.validateData()},s=function(){var t,i;switch(n.sliceCompletionLevel()){case PlaytimeType.Current:t=n.sliceTotal()?0:4;i=n.sliceTotal()?n.total().playtime:n.total().mainRemaining;break;case PlaytimeType.Main:t=n.sliceTotal()?1:4;i=n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining;break;case PlaytimeType.Extras:t=n.sliceTotal()?2:5;i=n.sliceTotal()?n.total().extrasTtb:n.total().extrasRemaining;break;case PlaytimeType.Completionist:t=n.sliceTotal()?3:6;i=n.sliceTotal()?n.total().completionistTtb:n.total().completionistRemaining;break;default:console.error("Invalid playtime slice type: "+n.sliceCompletionLevel());t=n.sliceTotal()?1:4;i=n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining}return{index:t,total:getHours(i,3)}},i="Unknown",d=function(n,t){var h=getOrderedOwnProperties(t),c=s(),r,o,f,u,e;for(n.dataProvider=[],r=[],o=0,f=0;f<h.length;f++){if(u=h[f],e=getHours(t[u][c.index]),u===i||e/c.total<.01){r.push(u);o+=e;continue}n.dataProvider.push({title:u,hours:e})}r.length>=1&&n.dataProvider.push({title:r.length===1&&r[0]!==i?r[0]:"Other",hours:o,color:unknownColor});n.validateData()},g=function(n){return function(t){return n<=t.max&&n>=t.min}},nt=function(n,t,i){for(var s,f,e,r=[],o=Math.round((t-n+1)/i),h=0,u=n;u<=t;u=u+o)s=Math.min(t,u+o-1),r.push({title:u+"-"+s,min:u,max:s,hours:0,color:progressivePalette[h++%progressivePalette.length],pulled:!0});return f=r[r.length-1],r.length>1&&f.max-f.min<o/2&&(e=r[r.length-2],e.max=f.max,e.title=e.min+"-"+f.max),r},tt=function(n,t,r,u){var e=getOrderedOwnProperties(t),l=s(),o,f,h,c,k,p,v,w,d;if(typeof u=="undefined"||u.pulled===!0)for(o=0;o<r.length;o++)f=r[o],f.hours=0,f.color=progressivePalette[o%progressivePalette.length],f.pulled=!1,f.description=" ("+f.min+"-"+f.max+")";else{var b=0,a=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;for(h=0;h<e.length;h++)c=Number(e[h]),c<r[0].min||c>r[r.length-1].max?b+=getHours(t[e[h]][l.index]):(a=Math.min(a,c),y=Math.max(y,c));a===Number.POSITIVE_INFINITY?r=[]:(k=(l.total-b)/l.total,r=nt(a,y,Math.round(k*10)))}for(p=r.concat([{title:i,min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY,hours:0,color:unknownColor,index:r.length,pulled:r[r.length-1].pulled}]),v=0;v<e.length;v++)w=e[v],d=ko.utils.arrayFirst(p,g(Number(w))),d.hours+=getHours(t[w][l.index]);n.dataProvider=p;n.validateData()},h=function(t,i){tt(n.metacriticChart,t.playtimesByMetacritic,[{title:"Overwhelming Dislike",min:0,max:19},{title:"Generally Unfavorable",min:20,max:49},{title:"Mixed or Average",min:50,max:74},{title:"Generally Favorable",min:75,max:89},{title:"Universal Acclaim",min:90,max:100}],i)},it=function(t){d(n.genreChart,t.playtimesByGenre)},r=function(n){it(n);h(n)},c=function(n){k(n);r(n)},l=function(n){var t=$("#"+n);t.height(t.width()*2/3)},a=function(n,t){return l(n),AmCharts.makeChart(n,{type:"serial",theme:"light",colors:alternatingPalette,dataProvider:t,categoryField:"playtime",valueAxes:[{axisAlpha:0,position:"left",title:"Hours"}],categoryAxis:{gridPosition:"start"},graphs:[{type:"column",valueField:"hours",colorField:"color",lineThickness:1.5,balloonText:"<b>[[value]] hours<\/b>",fillAlphas:.5,lineAlpha:.8}],precision:0,startDuration:1,responsive:{enabled:!0}})},v=function(n,t){return l(n),AmCharts.makeChart(n,{titles:[{text:t}],type:"pie",theme:"light",colors:alternatingPalette,marginLeft:0,marginRight:0,marginBottom:0,marginTop:25,pullOutRadius:"5%",valueField:"hours",colorField:"color",descriptionField:"description",pulledField:"pulled",precision:0,titleField:"title",labelRadius:10,labelText:"[[title]]",balloonText:"[[title]][[description]]: [[percents]]% ([[value]] hours)",balloon:{maxWidth:$("#genreChart").width()*2/3},startDuration:0,responsive:{enabled:!0}})},y=!0,rt=function(){if(!y){n.playtimeChart.animateAgain();n.remainingChart.animateAgain();return}y=!1;n.playtimeChart=a("playtimeChart",[{playtime:"Current",hours:0},{playtime:"Main",hours:0},{playtime:"Extras",hours:0},{playtime:"Complete",hours:0}]);n.remainingChart=a("remainingChart",[{playtime:"Main",hours:0},{playtime:"Extras",hours:0},{playtime:"Complete",hours:0}]);n.genreChart=v("genreChart","Playtime by Genre");n.metacriticChart=v("metacriticChart","Playtime by Metacritic score");n.metacriticChart.addListener("clickSlice",function(t){h(n.total(),t.dataItem.dataContext)});n.total.subscribe(c);n.sliceCompletionLevel.subscribe(function(){r(n.total())});n.sliceTotal.subscribe(function(t){t||n.sliceCompletionLevel()!==PlaytimeType.Current?r(n.total()):n.sliceCompletionLevel(PlaytimeType.Main)});c(n.total())},p=function(){$("html, body").animate({scrollTop:$("#alerts").offset().top-10},700)},ut=function(){n.processing(!0);var t=$(window).height();$(".loader").spin({lines:14,length:Math.ceil(t/25),width:Math.ceil(t/90),radius:Math.ceil(t/15)})},w=function(){n.processing(!1);$(".loader").spin(!1)},u=0,f=!1,e=!0;n.rowRendered=function(){var i,t,r,o;if(f&&(u++,!(u<Math.min(n.gameTable.perPage(),n.gameTable.filteredRows().length)))){if(f=!1,rt(),!e){p();return}i=$("#gameTable").width();t=0;$.each($("table th.compressed"),function(){var n=$(this).width()+10;t+=n;$(this).css("width",n+"px")});r=$("table th.expanded").size();o=(i-t)/r;$("table th.expanded").css("width",o+"px");$("#gameTable").css("table-layout","fixed");e=!1;w();p()}};b=function(t){for(var i,u=new Array(t.length),f=!1,e=!1,r=0;r<t.length;r++)i=new Game(t[r]),f||i.known?!e&&(i.hltbMainTtbImputed||i.hltbExtrasTtbImputed||i.hltbCompletionistTtbImputed)&&(n.imputedTtbs(!0),e=!0):(n.missingHltbIds(!0),n.imputedTtbs(!0),f=!0),u[r]=i;return u};n.loadGames=function(){n.currentRequest!==undefined&&n.currentRequest.abort();$("#content").hide();ut();n.error(!1);n.partialCache(!1);n.imputedTtbs(!1);n.missingHltbIds(!1);n.sliceTotal(!1);n.sliceCompletionLevel(PlaytimeType.Main);n.gameTable.filter("");n.gameTable.toggleSort("");n.currentRequest=$.get("api/games/library/"+n.steamVanityUrlName()).done(function(t){n.partialCache(t.PartialCache);n.gameTable.rows(b(t.Games));n.originalMainRemaining=n.total().mainRemaining;n.gameTable.rows().length>0&&($("#content").show(),n.gameTable.currentPageNumber(1),f=!0,u=0)}).fail(function(t){console.error(t);n.gameTable.rows([]);n.error(!0)}).always(function(){n.alertHidden(!1);n.missingAlertHidden(!1);n.errorAlertHidden(!1);e||w()})};n.displayUpdateDialog=function(t){n.gameToUpdate(t);$("#HltbUpdateModal").modal("show")};n.updateHltb=function(n){n.updatePhase(GameUpdatePhase.InProgress);$.post("api/games/update/"+n.steamAppId+"/"+n.suggestedHltbId()).done(function(){n.updatePhase(GameUpdatePhase.Success)}).fail(function(t){console.error(t);n.updatePhase(GameUpdatePhase.Failure)});$("#HltbUpdateModal").modal("hide")};n.getShortShareText=function(){return"I just found out I have over "+hoursWithCommas(n.originalMainRemaining)+" left to beat my entire Steam library!"};n.getShareText=function(){return n.getShortShareText()+" Click to check it out and find out how long you have too..."};n.shareOnFacebook=function(){n.openShareWindow("https://www.facebook.com/dialog/feed?app_id=445487558932250&display=popup&caption=HowLongToBeatSteam.com&description="+encodeURIComponent(n.getShareText())+"&link="+encodeURIComponent(window.location.href)+"&redirect_uri="+encodeURIComponent("http://howlongtobeatsteam.com/CloseWindow.html")+"&picture="+encodeURIComponent("http://howlongtobeatsteam.com/Resources/sk5_0.jpg"))};n.shareOnTwitter=function(){n.openShareWindow("https://twitter.com/share?url="+encodeURIComponent(window.location.href)+"&text="+n.getShortShareText()+"&hashtags=hltbs,steam")};n.shareOnGooglePlus=function(){n.openShareWindow("https://plus.google.com/share?url="+encodeURIComponent(window.location.href))};n.openShareWindow=function(n){window.open(n,"share","toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=600,height=600")}}var getOrderedOwnProperties=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t.sort(),t},duplicate=function(n,t){for(var i=n,r=0;r<t-1;r++)i=i.concat(n);return i},getHours=function(n,t){t===undefined&&(t=2);var i=Math.max(n,0)/60;return+i.toFixed(t)},numberWithCommas=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},timeWithCommas=function(n,t){return numberWithCommas(n)+" "+(n===1?t:t+"s")},hoursWithCommas=function(n){var t=getHours(n,0);return timeWithCommas(t,"hour")},getYears=function(n){return countdown(null,{minutes:n},countdown.YEARS|countdown.MONTHS|countdown.WEEKS|countdown.DAYS|countdown.HOURS).toString("0 hours")},GameUpdatePhase={None:"None",InProgress:"InProgress",Success:"Success",Failure:"Failure"},PlaytimeType={Current:"current",Main:"main",Extras:"extras",Completionist:"completionist"},alternatingPalette=duplicate(["#97BBCD","#75C7F0"],50),progressivePalette=["#97BBCD","#85C2E0","#75C7F0","#66CCFF","#66d7ff"],unknownColor="#ABB5BA",slashRegex=new RegExp("/","g"),genreSeparatorReplacer=function(n){return n.replace(slashRegex,"-")},trueObservable=ko.observable(!0),updatePhaseObservable=ko.observable(GameUpdatePhase.None),zeroObservable=ko.observable(0);Game.prototype.match=function(n){return this.steamName.toLowerCase().indexOf(n.toLowerCase())!==-1};$(document).ready(function(){var t,n,i;window.console||(t=function(){},window.console={log:t,warn:t,error:t});$('[data-toggle="tooltip"]').tooltip();$("#steamIdText").focus();n=new AppViewModel;ko.applyBindings(n);i=$.sammy(function(){this.get("#/",function(){n.introPage(!0)});this.get("#/:vanityUrlName",function(){n.introPage(!1);n.steamVanityUrlName(this.params.vanityUrlName);n.loadGames()})});i.run("#/")});
//# sourceMappingURL=app.min.js.map
