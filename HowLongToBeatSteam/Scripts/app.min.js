"use strict";function Game(n){var t=this,r,i;t.included=includedObservable;t.updatePhase=updatePhaseObservable;t.steamPlaytime=n.Playtime;r=n.SteamAppData;t.steamAppId=r.SteamAppId;t.steamName=r.SteamName;t.verifiedGame=r.VerifiedGame;t.appType=r.AppType;t.genres=ko.utils.arrayMap(r.Genres,genreSeparatorReplacer);t.releaseYear=r.ReleaseYear;t.metacriticScore=r.MetacriticScore;i=r.HltbInfo;t.known=i.Id!==-1;t.hltbId=t.known?i.Id:"";t.suggestedHltbId=emptyObservable;t.hltbName=t.known?i.Name:"";t.hltbMainTtb=i.MainTtb;t.hltbMainTtbImputed=i.MainTtbImputed;t.hltbExtrasTtb=i.ExtrasTtb;t.hltbExtrasTtbImputed=i.ExtrasTtbImputed;t.hltbCompletionistTtb=i.CompletionistTtb;t.hltbCompletionistTtbImputed=i.CompletionistTtbImputed}function AppViewModel(){var n=this,pt,f,s,i,t,h,c,l,w,b,a,u,r,k,e,bt,o,kt,d,oi,et,ot,vt,yt;Game.prototype.viewModel=n;n.width=$(window).width();n.height=$(window).height();n.superSmall=n.width<380;n.extraExtraSmall=n.width<480;n.extraSmall=n.width<768;n.small=n.width<992;n.medium=n.width<1200;$(window).on("orientationchange",function(){setTimeout(function(){location.reload()},0)});$(window).resize(function(){$(window).height()===n.width&&$(window).width()===n.height&&setTimeout(function(){location.reload()},0)});$("#hltb-update-modal").on("shown.bs.modal",function(){$("#hltb-update-intput").focus()});for(n.steamVanityUrlName=ko.observable(""),pt={recordWord:"game",sortDir:"asc",perPage:10,paginationLimit:n.superSmall?3:n.small?4:n.medium?6:10,unsortedClass:"glyphicon glyphicon-sort",ascSortClass:"glyphicon glyphicon-sort-by-attributes",descSortClass:"glyphicon glyphicon-sort-by-attributes-alt",alwaysMatch:!0},n.introPage=ko.observable(!0),n.externalPageTitle=ko.observable(""),n.externalPageUrl=ko.observable(""),n.authenticated=ko.observable(AuthenticationStatus.None),n.gameTable=new DataTable([],pt),n.pageSizeOptions=[10,25,50,100],n.gameTable.perPage.subscribe(function(n){appInsights.trackEvent("PerPageChanged",{},{perPage:n})}),n.sliceTotal=ko.observable(),n.sliceCompletionLevel=ko.observable(),n.partialCache=ko.observable(!1),n.excludedGameCount=ko.observable(0),n.imputedTtbs=ko.observable(!1),n.missingHltbIds=ko.observable(!1),n.libraryIsEmpty=ko.observable(!1),n.personaName=ko.observable(""),n.avatarUrl=ko.observable(""),n.processing=ko.observable(!1),n.status=ko.observable(""),n.error=ko.observable(!1),n.cached=ko.observable(!1),n.missing=ko.observable(!1),n.realUser=ko.observable(!0),n.alertHidden=ko.observable(!1),n.missingAlertHidden=ko.observable(!1),n.errorAlertHidden=ko.observable(!1),n.gameToUpdate=ko.observable({steamAppId:0,steamName:"",hltbId:"",suggestedHltbId:ko.observable("")}),f=function(){n.status("");n.processing(!1)},n.gameTable.filter.subscribe(function(n){appInsights.trackEvent("FilterApplied",{},{length:n.length})}),n.metacriticPossibleValues=ko.observableArray(),s=0;s<=100;s++)n.metacriticPossibleValues.push(s);for(n.metacriticFrom=ko.observable(0),n.metacriticFromApplied=ko.observable(0),n.metacriticTo=ko.observable(100),n.metacriticToApplied=ko.observable(100),n.metacriticRangeValid=ko.pureComputed(function(){return n.metacriticFrom()<=n.metacriticTo()}),n.metacriticFilterApplied=ko.pureComputed(function(){return n.metacriticFromApplied()>0||n.metacriticToApplied()<100}),i=1980,t=(new Date).getFullYear(),n.releaseYearPossibleValues=ko.observableArray(),h=i;h<=t;h++)n.releaseYearPossibleValues.push(h);n.releaseYearFrom=ko.observable(i);n.releaseYearFromApplied=ko.observable(i);n.releaseYearTo=ko.observable(t);n.releaseYearToApplied=ko.observable(t);n.releaseYearRangeValid=ko.pureComputed(function(){return n.releaseYearFrom()<=n.releaseYearTo()});n.releaseYearFilterApplied=ko.pureComputed(function(){return n.releaseYearFromApplied()>i||n.releaseYearToApplied()<t});n.genrePossibleFilters=ko.observableArray();n.genreSelectedFilters=ko.observableArray();n.genreAppliedFilter=ko.observable({});n.genreSelectionValid=ko.pureComputed(function(){return n.genrePossibleFilters().length===0||n.genreSelectedFilters().length>0});n.genreFilterApplied=ko.pureComputed(function(){var t=ko.utils.arrayFirst(n.genrePossibleFilters(),function(t){return!n.genreAppliedFilter()[t]});return t!==null});n.advancedFilterApplied=ko.pureComputed(function(){return n.metacriticFilterApplied()||n.releaseYearFilterApplied()||n.genreFilterApplied()});var y=function(t,i,r){for(var u=0;u<t.length;u++)n.genreAppliedFilter()[t[u]]=i;r||n.genreAppliedFilter.valueHasMutated()},wt=function(){n.metacriticFromApplied(0);n.metacriticToApplied(100);n.releaseYearFromApplied(i);n.releaseYearToApplied(t);y(n.genrePossibleFilters(),!0)},hi=function(){for(var i,t,u=n.gameTable.rows(),f={},r=0;r<u.length;r++)f[u[r].getCombinedGenre()]=!0;for(n.genrePossibleFilters([]),i=getOrderedOwnProperties(f),t=0;t<i.length;t++)i[t]!==unknownTitle&&(n.genreAppliedFilter()[i[t]]=!0,n.genrePossibleFilters.push(i[t]))},p=!1;for(n.advancedFilterClicked=function(){appInsights.trackEvent("advancedFilterClicked");p||(hi(),p=!0);n.genreSelectedFilters(ko.utils.arrayFilter(n.genrePossibleFilters(),function(t){return n.genreAppliedFilter()[t]}));n.metacriticFrom(n.metacriticFromApplied());n.metacriticTo(n.metacriticToApplied());n.releaseYearFrom(n.releaseYearFromApplied());n.releaseYearTo(n.releaseYearToApplied());$("#advanced-filter-modal").modal("show")},n.applyAdvancedFilter=function(){n.gameTable.currentPageNumber(1);y(n.genrePossibleFilters(),!1,!0);y(n.genreSelectedFilters(),!0);n.metacriticFromApplied(n.metacriticFrom());n.metacriticToApplied(n.metacriticTo());n.releaseYearFromApplied(n.releaseYearFrom());n.releaseYearToApplied(n.releaseYearTo());appInsights.trackEvent("AdvancedFilterApplied",{},{MetacriticFrom:n.metacriticFrom(),MetacriticTo:n.metacriticTo(),ReleaseYearFrom:n.releaseYearFrom(),ReleaseYearTo:n.releaseYearTo(),GenresIncluded:n.genreSelectedFilters().length,GenresPossible:n.genrePossibleFilters().length});$("#advanced-filter-modal").modal("hide")},n.clearAdvancedFilter=function(){n.gameTable.currentPageNumber(1);wt();appInsights.trackEvent("ClearAdvancedFilter");$("#advanced-filter-modal").modal("hide")},n.userGender=ko.observable("male"),n.userBirthYear=ko.observable(t-30),n.birthYearPossibleValues=ko.observableArray(),c=t-120;c<=t;c++)n.birthYearPossibleValues.push(c);for(n.weeklyPlayHours=ko.observable(10),n.weeklyPlayHoursPossibleValues=ko.observableArray(),l=1;l<=150;l++)n.weeklyPlayHoursPossibleValues.push(l);n.userPlayStyle=ko.observable(PlaytimeType.Main);n.playStylePossibleValues=ko.observableArray([PlaytimeType.Main,PlaytimeType.Extras,PlaytimeType.Completionist]);w=[{prefix:"You will die happy, having completed your backlog with",suffix:"left to live."},{prefix:"Not only will you complete your backlog, you'll have",suffix:"to relax after."},{prefix:"Now is the time to go buy more games for your barren",suffix:"of post-backlog."}];b=[{prefix:"You will die a horrible death,",suffix:"before beating your backlog."},{prefix:"You'd need",suffix:"more to live in order to complete your backlog."},{prefix:"Looks like the Grim Reaper is going to beat you by",suffix:":("}];n.survivalCalculated=ko.observable(!1);n.survivalCalculationError=ko.observable(!1);n.calculatingSurvival=ko.observable(!1);n.remainingWeeksToLiveAfterBacklogCompletion=ko.observable(0);n.timeOfDeath=ko.observable(new Date);n.timeOfBacklogCompletion=ko.observable(new Date);n.survivalPrefix=ko.observable("");n.survivalSuffix=ko.observable("");n.survivalYears=ko.observable("");n.survivalCalculatorClicked=function(){appInsights.trackEvent("survivalCalculatorClicked");n.survivalCalculated(!1);n.survivalCalculationError(!1);$("#steam-survival-modal").modal("show")};n.calculateSurvival=function(){appInsights.trackEvent("SurvivalCalculated",{gender:n.userGender()},{birthYear:n.userBirthYear()});n.calculatingSurvival(!0);$.get("api/survival/life-expectancy/remaining/{0}/{1}/{2}".format("World",n.userGender(),(new Date).getFullYear()-n.userBirthYear())).done(function(t){var u,f,i,r;n.survivalCalculationError(!1);n.timeOfDeath(getTimeFromNow(t.RemainingHours));u=n.userPlayStyle()===PlaytimeType.Completionist?n.total().completionistRemaining:n.userPlayStyle()===PlaytimeType.Extras?n.total().extrasRemaining:n.total().mainRemaining;f=u/60/n.weeklyPlayHours();n.timeOfBacklogCompletion(getTimeFromNow(f*168));n.timeOfDeath()<n.timeOfBacklogCompletion()?(i=b[Math.floor(Math.random()*b.length)],r=getYearsFromDateDiff(n.timeOfDeath(),n.timeOfBacklogCompletion())):(i=w[Math.floor(Math.random()*w.length)],r=getYearsFromDateDiff(n.timeOfBacklogCompletion(),n.timeOfDeath()));n.survivalPrefix(i.prefix);n.survivalSuffix(i.suffix);n.survivalYears(r)}).fail(function(t){appInsights.trackException(t);n.survivalCalculationError(!0)}).always(function(){n.calculatingSurvival(!1);n.survivalCalculated(!0)})};n.toggleAllChecked=ko.observable(!0);n.toggleAllCore=function(t){for(var r=n.gameTable.rows(),i=0;i<r.length;i++)r[i].included(t)};a=!1;n.toggleAll=function(){return appInsights.trackEvent("ToggleAll"),a=!0,n.toggleAllCore(!n.toggleAllChecked()),a=!1,!0};u=function(t,i){n.gameTable.gotoPage(i)();appInsights.trackEvent(t,{},{page:n.gameTable.currentPageNumber(),totalPages:n.gameTable.pages().length})};n.gotoPage=function(t){n.gameTable.currentPageNumber()!==t.number&&u("NavigatedToPage",t.number)};n.gotoFirstPage=function(){n.gameTable.currentPageNumber()>1&&u("NavigatedToFirstPage",1)};n.gotoLastPage=function(){n.gameTable.currentPageNumber()<n.gameTable.pages().length&&u("NavigatedToLastPage",n.gameTable.pages().length)};n.gotoPrevPage=function(){n.gameTable.currentPageNumber()>1&&u("NavigatedToPreviousPage",n.gameTable.currentPageNumber()-1)};n.gotoNextPage=function(){n.gameTable.currentPageNumber()<n.gameTable.pages().length&&u("NavigatedToNextPage",n.gameTable.currentPageNumber()+1)};r=function(t){n.gameTable.toggleSort(t)();appInsights.trackEvent("Sort",{field:t,direction:n.gameTable.sortDir()})};n.toggleNameSort=function(){r("steamName")};n.togglePlaytimeSort=function(){r("steamPlaytime")};n.toggleMainTtbSort=function(){r("hltbMainTtb")};n.toggleExtrasTtbSort=function(){r("hltbExtrasTtb")};n.toggleCompletionistTtbSort=function(){r("hltbCompletionistTtb")};n.toggleHltbNameSort=function(){r("hltbName")};k=function(t){n.sliceTotal(t);appInsights.trackEvent("Slice",{by:t?"Total":"Remaining"})};n.sliceTotalClicked=function(){k(!0)};n.sliceRemainingClicked=function(){k(!1)};e=function(t){n.sliceCompletionLevel(t);appInsights.trackEvent("Slice",{by:t})};n.sliceCurrentClicked=function(){e(PlaytimeType.Current)};n.sliceMainClicked=function(){e(PlaytimeType.Main)};n.sliceExtrasClicked=function(){e(PlaytimeType.Extras)};n.sliceCompletionistClicked=function(){e(PlaytimeType.Completionist)};bt=function(n,t,i,r,u,f){switch(n){case PlaytimeType.Current:return t?i.steamPlaytime:r;case PlaytimeType.Main:return t?i.hltbMainTtb:r;case PlaytimeType.Extras:return t?i.hltbExtrasTtb:u;case PlaytimeType.Completionist:return t?i.hltbCompletionistTtb:f;default:return appInsights.trackException("Invalid playtime slice type: "+n),0}};o=function(n,t,i){n.hasOwnProperty(t)?n[t]+=i:n[t]=i};n.total=ko.pureComputed(function(){var i=n.gameTable.filteredRows(),et=n.sliceCompletionLevel(),ot=n.sliceTotal(),s,u,h,e,t,r;if(n.initialTotal!==undefined){for(includedObservable(),s=Math.min(i.length,n.gameTable.perPage()),u=0;u<s;u++)i[u].included();return n.toggleAllChecked(!0),h=n.initialTotal,n.initialTotal=undefined,h}var f=0,c=0,l=0,a=0,v=0,y=0,p=0,w=0,b=0,k=0,d=0,g={},nt={},tt={},it={};for(e=0;e<i.length;++e)if(t=i[e],t.included()){f++;c+=t.steamPlaytime;l+=t.hltbMainTtb;a+=t.hltbExtrasTtb;v+=t.hltbCompletionistTtb;b+=Math.min(t.steamPlaytime,t.hltbMainTtb);k+=Math.min(t.steamPlaytime,t.hltbExtrasTtb);d+=Math.min(t.steamPlaytime,t.hltbCompletionistTtb);var rt=Math.max(0,t.hltbMainTtb-t.steamPlaytime),ut=Math.max(0,t.hltbExtrasTtb-t.steamPlaytime),ft=Math.max(0,t.hltbCompletionistTtb-t.steamPlaytime);y+=rt;p+=ut;w+=ft;r=bt(et,ot,t,rt,ut,ft);o(g,t.getCombinedGenre(),r);o(nt,t.metacriticScore,r);o(tt,t.appType,r);o(it,t.releaseYear,r)}return f===i.length?n.toggleAllChecked(!0):f===0&&n.toggleAllChecked(!1),{count:f,playtime:c,mainTtb:l,extrasTtb:a,completionistTtb:v,mainRemaining:y,extrasRemaining:p,completionistRemaining:w,mainCompleted:b,extrasCompleted:k,completionistCompleted:d,playtimesByGenre:g,playtimesByMetacritic:nt,playtimesByAppType:tt,playtimesByReleaseYear:it}}).extend({rateLimit:0});kt=function(n){a||appInsights.trackEvent("GameIncludeToggled",{included:n})};n.pagedGames=ko.pureComputed(function(){for(var t,i=n.gameTable.pagedRows(),u=!1,r=0;r<i.length;r++)t=i[r],t.included===includedObservable&&(t.included=ko.observable(includedObservable.peek()),t.included.subscribe(kt),t.updatePhase=ko.observable(updatePhaseObservable()),t.suggestedHltbId=ko.observable(""),u=!0);return u&&includedObservable.valueHasMutated(),i});d=function(t){var i=n.steamVanityUrlName().split(t),r;i.length>1&&(r=i[1],n.steamVanityUrlName(r.split("/")[0]))};n.vanityUrlSubmitted=function(){d("steamcommunity.com/id/");d("steamcommunity.com/profiles/");window.location.hash==="#/"+n.steamVanityUrlName()&&n.sammyApp.runRoute("get",window.location.hash)};var ci=function(t){n.playtimeChart.dataProvider[0].current=getHours(t.playtime);n.playtimeChart.dataProvider[1].completed=getHours(t.mainCompleted);n.playtimeChart.dataProvider[1].remaining=getHours(t.mainRemaining);n.playtimeChart.dataProvider[2].completed=getHours(t.extrasCompleted);n.playtimeChart.dataProvider[2].remaining=getHours(t.extrasRemaining);n.playtimeChart.dataProvider[3].completed=getHours(t.completionistCompleted);n.playtimeChart.dataProvider[3].remaining=getHours(t.completionistRemaining);n.playtimeChart.invalidateSize();n.playtimeChart.validateData()},g=function(){switch(n.sliceCompletionLevel()){case PlaytimeType.Current:return getHours(n.sliceTotal()?n.total().playtime:n.total().mainRemaining);case PlaytimeType.Main:return getHours(n.sliceTotal()?n.total().mainTtb:n.total().mainRemaining);case PlaytimeType.Extras:return getHours(n.sliceTotal()?n.total().extrasTtb:n.total().extrasRemaining);case PlaytimeType.Completionist:return getHours(n.sliceTotal()?n.total().completionistTtb:n.total().completionistRemaining);default:return appInsights.trackException("Invalid playtime slice type: "+n.sliceCompletionLevel()),0}},dt=function(n,t){var o=getOrderedOwnProperties(t),s=g(),i,e,u,r,f;for(n.dataProvider=[],i=[],e=0,u=0;u<o.length;u++){if(r=o[u],f=getHours(t[r]),r===unknownTitle||f/s<.01){i.push(r);e+=f;continue}n.dataProvider.push({title:r,hours:f})}i.length>=1&&n.dataProvider.push({title:i.length===1&&i[0]!==unknownTitle?i[0]:"Other",hours:e,color:unknownColor});n.invalidateSize();n.validateData()},li=function(n){return function(t){return n<=t.max&&n>=t.min}},nt=function(n,t){return n===t?n:n+"-"+t},gt=function(n,t,i){for(var o,e,r,f=0;f<t.length;f++)t[f].observedMin=Number.POSITIVE_INFINITY,t[f].observedMax=Number.NEGATIVE_INFINITY;for(o=getOrderedOwnProperties(n),e=0;e<o.length;e++){var s=o[e],c=n[s],h=Number(s),u=ko.utils.arrayFirst(t,li(h));u.hours+=getHours(c);u.observedMin=Math.min(u.observedMin,h);u.observedMax=Math.max(u.observedMax,h);typeof i!="undefined"&&i(u,s,c)}for(r=0;r<t.length;r++)t[r].observedMin!==Number.POSITIVE_INFINITY&&(t[r].min=t[r].observedMin,t[r].max=t[r].observedMax,t[r].index===-1&&(t[r].title=nt(t[r].min,t[r].max)))},tt=function(n,t,i){return n===t?n:{title:nt(n.min,t.max),min:n.min,max:t.max,hours:i,color:t.color,pulled:!0,index:-1}},ai=function(n,t){for(var u=[],e=.5*(1/n.length),r=0,f=0,i=0;i<n.length;i++){if(n[i].hours/t<e){f+=n[i].hours;continue}i>r&&u.push(tt(n[r],n[i-1],f));u.push(n[i]);r=i+1;f=0}return r<n.length&&u.push(tt(n[r],n[n.length-1],f)),u},vi=function(n,t,i){for(var o,f,s,r=[],e=Math.ceil((t.max-t.min+1)/i),u=t.min;u<=t.max;u=u+e)o=Math.min(t.max,u+e-1),r.push({title:nt(u,o),min:u,max:o,hours:0,color:t.color,pulled:!0,index:-1});return f=r[r.length-1],r.length>1&&f.max-f.min<e/2&&(s=r[r.length-2],r.splice(r.length-2,2,tt(s,f,0))),gt(n,r),ai(r,t.hours)},yi=function(n,t){for(var i=0;i<n.length;i++)n[i].hours=0,n[i].color=progressivePalette[i%progressivePalette.length],n[i].pulled=!1,n[i].description=" ("+n[i].min+"-"+n[i].max+")",n[i].index=i;n.push({title:unknownTitle,min:Number.NEGATIVE_INFINITY,max:Number.POSITIVE_INFINITY,hours:0,color:unknownColor,pulled:t,index:n.length})},ni=function(t,i,r,u){var e=typeof u!="undefined",f=null,o,s,h;if(e){if(n.extraSmall)return;f=u.dataContext}yi(r,e&&f.title===unknownTitle&&u.pulled);o={};s=e&&f.index!==-1&&f.title!==unknownTitle;gt(i,r,s?function(n,t,i){n.index===f.index&&(o[t]=i)}:undefined);s&&(h=Math.round(f.hours/g()*10)+1,r.splice.apply(r,[f.index,1].concat(vi(o,f,h))));t.dataProvider=r;t.invalidateSize();t.validateData()},ti=function(t,i){ni(n.metacriticChart,t.playtimesByMetacritic,[{title:"Overwhelming Dislike",min:0,max:19},{title:"Generally Unfavorable",min:20,max:49},{title:"Mixed or Average",min:50,max:74},{title:"Generally Favorable",min:75,max:89},{title:"Universal Acclaim",min:90,max:100}],i)},pi=function(t){dt(n.genreChart,t.playtimesByGenre)},wi=function(t){dt(n.appTypeChart,t.playtimesByAppType)},ii=function(r,u){for(var e=[],f=i;f<=t;f+=10)e.push({title:f.toString().substring(2)+"s",min:f,max:f+9});ni(n.releaseDateChart,r.playtimesByReleaseYear,e,u)},bi=function(n){var t=$(".slice-chart"),i=$(".no-data-indicator");if(g()===0){t.hide();i.show();return}t.show();i.hide();pi(n);ti(n);wi(n);ii(n)},ki=function(n){ci(n);bi(n)},ri=function(t,i){var u,r,f;typeof i=="undefined"&&(i=1);u=$("#"+t);r=u.width()*i*(n.superSmall?1.3:2/3);u.height(r);f=$("#"+t+"NoData");f.height(r);f.css("line-height",r+"px")},di=function(t,i){ri(t,Math.max(Math.min(768/n.width,.9),.6));var r=AmCharts.makeChart(t,{panEventsEnabled:!1,type:"serial",theme:"light",pathToImages:"https://www.amcharts.com/lib/3/images/",rotate:!n.extraSmall,colors:alternatingPalette,dataProvider:i,categoryField:"playtimeType",valueAxes:[{axisAlpha:0,stackType:"regular",position:"left"}],categoryAxis:{gridPosition:"start",labelRotation:n.superSmall?45:0},graphs:[{type:"column",valueField:"completed",lineThickness:1.5,balloonText:"<b>[[value]] hours completed<\/b> ([[percents]]%)",fillAlphas:.5,lineAlpha:.8},{type:"column",valueField:"remaining",lineThickness:1.5,balloonText:"<b>[[value]] hours remaining<\/b> ([[percents]]%)",fillAlphas:.5,lineAlpha:.8},{type:"column",valueField:"current",lineThickness:1.5,balloonText:"<b>[[value]] total hours played<\/b>",fillAlphas:.5,lineAlpha:.8}],precision:0,startDuration:typeof orientation=="undefined"?1.5:0,responsive:{enabled:!0,rules:[{minWidth:1,overrides:{categoryAxis:{labelsEnabled:!0,ignoreAxisWidth:!1,inside:!1,showFirstLabel:!0,showLastLabel:!0}}}]}});return r.balloon.maxWidth*=.9,r},v=function(t,i,r){ri(t);var u=AmCharts.makeChart(t,{panEventsEnabled:!1,type:"pie",theme:"light",pathToImages:"https://www.amcharts.com/lib/3/images/",colors:alternatingPalette,marginLeft:0,marginRight:0,marginBottom:15,marginTop:i,pullOutRadius:"5%",pullOutDuration:0,pullOutOnlyOne:typeof r=="undefined",valueField:"hours",colorField:"color",descriptionField:"description",pulledField:"pulled",precision:0,titleField:"title",labelRadius:10,labelText:"[[title]]",balloonText:"[[title]][[description]]: [[percents]]% ([[value]] hours)",balloon:{maxWidth:$("#"+t).width()*2/3},startDuration:0,responsive:{enabled:!0}});return u.addListener("clickSlice",function(){appInsights.trackEvent("SliceClicked",{chart:t})}),typeof r!="undefined"&&u.addListener("clickSlice",function(t){r(n.total(),t.dataItem)}),u},it=!1,ui=!1,gi=function(){ui||(ui=!0,n.playtimeChart=di("playtimeChart",[{playtimeType:"Current",hours:0},{playtimeType:"Main",hours:0},{playtimeType:"Extras",hours:0},{playtimeType:"Complete",hours:0}]),n.playtimeChart.addListener("dataUpdated",function(){it&&n.total().count>0&&(n.playtimeChart.animateAgain(),it=!1)}),n.genreChart=v("genreChart",25),n.metacriticChart=v("metacriticChart",25,ti),n.appTypeChart=v("appTypeChart",40),n.releaseDateChart=v("releaseDateChart",40,ii),n.total.subscribe(ki),n.sliceTotal.subscribe(function(t){t||n.sliceCompletionLevel()!==PlaytimeType.Current||n.sliceCompletionLevel(PlaytimeType.Main)}))},fi=!1,nr=function(){fi||(setTimeout(function(){n.genreChart.invalidateSize();n.metacriticChart.invalidateSize();n.releaseDateChart.invalidateSize();n.appTypeChart.invalidateSize()},0),fi=!0)},ei="scroll mousedown DOMMouseScroll mousewheel keyup touchstart",tr=function(){if(!(window.pageYOffset>0)){var n=$("html, body");n.animate({scrollTop:$("#alerts").offset().top-10},1500);n.bind(ei,function(t){(t.which>0||t.type==="mousedown"||t.type==="mousewheel"||t.type==="touchstart")&&n.stop().unbind(ei)})}},rt=0,ut=!1,ft=!0;n.rowRendered=function(t){if(n.extraSmall){var i=ko.utils.arrayFirst(t,function(n){return n.tagName==="TR"});$(i).find("span[data-toggle='tooltip']:first").tooltip()}ut&&((rt++,rt<Math.min(n.gameTable.perPage(),n.gameTable.filteredRows().length))||(ut=!1,f(),nr(),tr(),ft&&($.each($("table th.compressed"),function(){$(this).css("width",$(this).width()+10+"px")}),$("#game-table").css("table-layout","fixed"),ft=!1)))};oi=function(t){for(var i,u=new Array(t.length),f=!1,e=!1,r=0;r<t.length;r++)i=new Game(t[r]),f||i.known?!e&&(i.hltbMainTtbImputed||i.hltbExtrasTtbImputed||i.hltbCompletionistTtbImputed)&&(n.imputedTtbs(!0),e=!0):(n.missingHltbIds(!0),n.imputedTtbs(!0),f=!0),u[r]=i;return u};n.loadGames=function(){n.currentRequest!==undefined&&n.currentRequest.abort();n.processing(!0);n.status("Retrieving Data...");$("html, body").animate({scrollTop:0},500);n.error(!1);n.partialCache(!1);n.excludedGameCount(0);n.imputedTtbs(!1);n.missingHltbIds(!1);n.libraryIsEmpty(!1);n.sliceTotal(!0);n.sliceCompletionLevel(PlaytimeType.Main);n.gameTable.filter("");wt();p=!1;n.gameTable.toggleSort("");n.cached(n.steamVanityUrlName().indexOf("cached/")!==-1);n.missing(n.steamVanityUrlName().indexOf("missing/")!==-1);n.realUser(!n.cached()&&!n.missing());n.currentRequest=$.get("api/games/library/"+n.steamVanityUrlName()).done(function(t){if(ut=!0,includedObservable(!0),n.partialCache(t.PartialCache),n.excludedGameCount(t.ExcludedCount),n.personaName(t.PersonaInfo.PersonaName),n.avatarUrl(t.PersonaInfo.Avatar),n.initialTotal={count:t.Games.length,playtime:t.Totals.Playtime,mainTtb:t.Totals.MainTtb,extrasTtb:t.Totals.ExtrasTtb,completionistTtb:t.Totals.CompletionistTtb,mainRemaining:t.Totals.MainRemaining,extrasRemaining:t.Totals.ExtrasRemaining,completionistRemaining:t.Totals.CompletionistRemaining,mainCompleted:t.Totals.MainCompleted,extrasCompleted:t.Totals.ExtrasCompleted,completionistCompleted:t.Totals.CompletionistCompleted,playtimesByGenre:t.Totals.PlaytimesByGenre,playtimesByMetacritic:t.Totals.PlaytimesByMetacritic,playtimesByAppType:t.Totals.PlaytimesByAppType,playtimesByReleaseYear:t.Totals.PlaytimesByReleaseYear},n.gameTable.rows(oi(t.Games)),n.originalMainRemaining=t.Totals.MainRemaining,n.gameTable.rows().length>0)n.gameTable.currentPageNumber(1),rt=0;else{n.libraryIsEmpty(!0);n.introPage(!0);f();return}ft?n.status("Processing Data..."):f()}).fail(function(t){appInsights.trackException(t);n.gameTable.rows([]);n.error(!0);n.introPage(!0);f()}).always(function(){n.alertHidden(!1);n.missingAlertHidden(!1);n.errorAlertHidden(!1)});gi();it=!0};n.displayNonGameDialog=function(t){appInsights.trackEvent("UpdateNonGameClicked");n.gameToUpdate(t);$("#non-game-update-modal").modal("show")};n.displayUpdateDialog=function(t){appInsights.trackEvent("UpdateClicked",{known:t.known});n.gameToUpdate(t);$("#hltb-update-modal").modal("show")};et=function(t,i){n.externalPageUrl(t);n.externalPageTitle(i);var r=$(window).height(),u=r<=320?.6:r<=480?.7:.8;$("#external-modal-body").height(u*r);$("#external-modal").modal("show")};n.displayPrivacyPolicy=function(){appInsights.trackEvent("PrivacyPolicyClicked");et("Pages/Privacy.html","Privacy Policy")};n.displayFaq=function(){appInsights.trackEvent("FaqClicked");et("Pages/FAQ.html","Frequently Asked Questions")};ot=function(n){n.updatePhase(GameUpdatePhase.InProgress);$.post("api/games/update/"+n.steamAppId+"/"+n.suggestedHltbId()).done(function(){n.updatePhase(GameUpdatePhase.Success)}).fail(function(t){appInsights.trackException(t);n.updatePhase(GameUpdatePhase.Failure)})};n.updateNonGame=function(){n.gameToUpdate().suggestedHltbId(-1);n.gameToUpdate().included(!1);ot(n.gameToUpdate());$("#non-game-update-modal").modal("hide");appInsights.trackEvent("NonGameUpdateSubmitted")};n.updateHltb=function(){ot(n.gameToUpdate());$("#hltb-update-modal").modal("hide");appInsights.trackEvent("UpdateSubmitted",{known:n.gameToUpdate().known})};var ir=function(){return window.location.hostname==="localhost"?"www.howlongtobeatsteam.com":window.location.hostname},st=function(){return window.location.protocol+"//"+ir()},ht=function(){return st()+window.location.pathname+window.location.hash},ct=function(t){return"I just found out I have over "+(t?hoursWithCommas(n.originalMainRemaining):getYearsFromMinutes(n.originalMainRemaining)+" of consecutive gameplay")+" left to beat my entire Steam library!"},lt=function(){return n.timeOfDeath()<n.timeOfBacklogCompletion()?"Looks like I'm missing "+getYearsFromDateDiff(n.timeOfDeath(),n.timeOfBacklogCompletion())+" from my life to be able to complete my Steam backlog :)":"Looks like I'll be able to complete my Steam backlog in this lifetime with "+getYearsFromDateDiff(n.timeOfBacklogCompletion(),n.timeOfDeath())+" to spare:)"},at=function(n,t){window.open(n,"share","toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, height=600, width="+(t?"900":"600"))},si=function(n,t){appInsights.trackEvent(n,{site:"Facebook"});at("https://www.facebook.com/dialog/feed?"+$.param({app_id:"445487558932250",display:"popup",caption:"HowLongToBeatSteam",description:t+" facebook.com/howlongtobeatsteam",link:ht(),redirect_uri:st()+"/CloseWindow.html",picture:st()+"/Resources/sk5_0.jpg"}))};n.shareOnFacebook=function(){si("Shared",ct(!1))};n.shareSurvivalOnFacebook=function(){si("SharedSurvival",lt())};vt=function(n,t){appInsights.trackEvent(n,{site:"Twitter"});at("https://twitter.com/share?"+$.param({url:ht(),text:t,hashtags:"hltbsteam"}))};n.shareOnTwitter=function(){vt("Shared",ct(!0))};n.shareSurvivalOnTwitter=function(){vt("SharedSurvival",lt())};yt=function(n,t){appInsights.trackEvent(n,{site:"Reddit"});at("https://www.reddit.com/submit?"+$.param({url:ht(),title:t,resubmit:!0}),!0)};n.shareOnReddit=function(){yt("Shared",ct(!1))};n.shareSurvivalOnReddit=function(){yt("SharedSurvival",lt())};n.authenticate=function(){appInsights.trackEvent("SteamLogin");window.location.href="/Authentication"}}String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i]!="undefined"?n[i]:t})});var getOwnProperties=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t},getOrderedOwnProperties=function(n){var t=getOwnProperties(n);return t.sort(function(n,t){var i=n.toLowerCase(),r=t.toLowerCase();return i<r?-1:i>r?1:0}),t},capitalizeFirstLetter=function(n){return n.charAt(0).toUpperCase()+n.slice(1)},getHours=function(n,t){t===undefined&&(t=2);var i=Math.max(n,0)/60;return+i.toFixed(t)},numberWithCommas=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},timeWithCommas=function(n,t){return numberWithCommas(n)+" "+(n===1?t:t+"s")},hoursWithCommas=function(n){var t=getHours(n,0);return timeWithCommas(t,"hour")},getYearsFromMinutes=function(n){return countdown(null,{minutes:n},countdown.YEARS|countdown.MONTHS|countdown.WEEKS|countdown.DAYS|countdown.HOURS).toString("0 hours")},getYearsFromDateDiff=function(n,t){return countdown(n,t,countdown.YEARS,0,2,"0 years")},getPercent=function(n,t){return(100*n/t).toFixed(2)+"%"},GameUpdatePhase={None:"None",InProgress:"InProgress",Success:"Success",Failure:"Failure"},PlaytimeType={Current:"Current",Main:"Main",Extras:"Extras",Completionist:"Completionist"},AuthenticationStatus={None:"None",Success:"Success",Failure:"Failure"},alternatingPalette=[],progressivePalette=["#75c7f0","#6CC3EF","#6CC3EF","#5ABCED","#47B4EB","#35ADE9","#23A5E7","#189BDC","#168ECA","#1481B8"],unknownColor="#ABB5BA",unknownTitle="Unknown",slashRegex=new RegExp("/","g"),genreSeparatorReplacer=function(n){return n.replace(slashRegex,"-")},isBetween=function(n,t,i){return n>=t&&n<=i},getTimeFromNow=function(n){var t=new Date;return t.setUTCHours(t.getUTCHours()+n),t},includedObservable=ko.observable(!0),updatePhaseObservable=ko.observable(GameUpdatePhase.None),emptyObservable=ko.observable("");Game.prototype.match=function(n){var t=this.viewModel.metacriticFilterApplied(),i=this.viewModel.metacriticFromApplied(),r=this.viewModel.metacriticToApplied(),u=this.viewModel.releaseYearFilterApplied(),f=this.viewModel.releaseYearFromApplied(),e=this.viewModel.releaseYearToApplied(),o=this.viewModel.genreFilterApplied(),s=this.viewModel.genreAppliedFilter();return this.steamName.toLowerCase().indexOf(n.toLowerCase())!==-1&&(!t||isBetween(this.metacriticScore,i,r))&&(!u||isBetween(this.releaseYear,f,e))&&(!o||s[this.getCombinedGenre()])};Game.prototype.getCombinedGenre=function(){if(!this.combinedGenre){var n=ko.utils.arrayFilter(this.genres,function(n){return n!=="Indie"&&n!=="Casual"});this.combinedGenre=(n.length===0?this.genres:n).join("/")}return this.combinedGenre};$(document).ready(function(){var t,n,i;for($("#copyright-year").text((new Date).getFullYear()),t=0;t<50;t++)alternatingPalette.push("#75C7F0","#97BBCD");$('span[data-toggle="tooltip"]').tooltip();n=new AppViewModel;ko.applyBindings(n);i=$.sammy(function(){this.get("#/",function(){appInsights.trackEvent("NavigatedToHomepage");n.steamVanityUrlName("");n.introPage(!0);setTimeout(function(){$("#steam-id-text").focus()},0)});var t=function(t){n.introPage(!1);n.steamVanityUrlName(t);n.loadGames()};this.get("#/:vanityUrlName",function(){n.authenticated(AuthenticationStatus.None);appInsights.trackEvent("LoadGames",{authenticated:!1});t(this.params.vanityUrlName)});this.get("#/auth/:steamid",function(){if(this.params.steamid==="failed"){n.authenticated(AuthenticationStatus.Failure);n.introPage(!1);n.error(!0);return}n.authenticated(AuthenticationStatus.Success);appInsights.trackEvent("LoadGames",{authenticated:!0});t(this.params.steamid)});this.get("#/cached/:count",function(){appInsights.trackEvent("LoadCachedGames",{},{count:parseInt(this.params.count)});t("cached/"+this.params.count)});this.get("#/missing/:count",function(){appInsights.trackEvent("LoadMissingGames",{},{count:parseInt(this.params.count)});t("missing/"+this.params.count)})});n.sammyApp=i;i.run("#/")});
//# sourceMappingURL=app.min.js.map